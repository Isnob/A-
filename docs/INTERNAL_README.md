# Pathfinding Visualizer — внутренняя памятка

Этот документ для участников команды, чтобы быстро вспомнить, что уже реализовано и куда смотреть при развитии проекта.

## TL;DR

- `poetry install` или `pip install -r requirements.txt`.
- GUI: `python -m src.gui.app --mazes path/to/mazes.yaml` (аргумент опционален, по умолчанию берётся `config/config.yaml`).
- CLI генератор/удаление/консольная симуляция: `python -m src.main ...` (см. команды ниже).
- Лабиринты лежат в YAML, ключ — имя, значение — список строк. Минимизируйте пробелы, иначе визуализация поедет.

## Структура и роли

```
src/
├── main.py               # CLI-интерфейс
├── gui/
│   ├── app.py            # точка входа PyQt6
│   ├── main_window.py    # сцепка GUI с ядром
│   ├── controls_panel.py # форма с кнопками/слайдерами
│   └── maze_view.py      # отрисовка сетки и состояний алгоритма
├── core/
│   ├── manager.py        # фасад: загрузка, генерация, запуск solver-ов
│   ├── maze.py           # модель клеток лабиринта (нужно дописать)
│   └── algorithms/
│       ├── astar.py
│       ├── bfs.py
│       └── dijkstra.py
└── utils/
    └── maze_generator.py # базовый генератор и запись в YAML
```

### Конфигурация

- Основной файл: `config/config.yaml`. Структура: `maze_name: [row1, row2, ...]`.
- Если нужно работать с другой коллекцией лабиринтов, передайте путь через `--mazes` при запуске GUI.
- Генератор (`Manager.generate_and_write_maze`) перезаписывает/добавляет ключ в YAML и сохраняет порядок.

### Manager и солверы

- `Manager.start_simulation(maze_name, config_path, algorithm, delay)` грузит YAML, создаёт `Maze`, выбирает солвер и отдаёт `(maze, solver)` GUI.
- Алгоритмы реализуют `step()` → `(status, path)` и (по возможности) `get_state()` с ключами `path`, `visited`, `frontier`, `current`. `MazeView` ожидает именно такой словарь.
- Сейчас доступны `A* (Chebyshev)`, `BFS`, `Dijkstra`. Добавление нового алгоритма = файл в `src/core/algorithms`, регистрация в `Manager._create_solver` и `ControlsPanel`.

### GUI поток

1. `src.gui.app.main()` парсит `--mazes`, заводит `QApplication`, создаёт `MainWindow`.
2. `MainWindow`:
   - грузит имена лабиринтов из YAML;
   - держит `Manager`, `Maze`, `solver`, состояние таймера;
   - реагирует на сигналы `ControlsPanel` (генерация/удаление/выбор/старт/пауза/шаг/скорость);
   - каждое срабатывание `_on_timer_tick` вызывает `solver.step()`, собирает `state` и передаёт его в `MazeView`.
3. `ControlsPanel` инкапсулирует весь UI и эмитит только сигналы, никакой бизнес-логики внутри нет.
4. `MazeView` рисует сетку, стены и состояние алгоритма. Приоритет раскраски: start/finish → visited → frontier → path → current.

### CLI сценарии (`python -m src.main`)

- `generate NAME [--width 50 --height 20 --start-x 1 --start-y 1 --finish-x 40 --finish-y 18 --density 0.5]`
- `delete NAME`
- `run_cli_simulation NAME {astar,bfs,dijkstra} DELAY_SECONDS`

Все команды работают поверх `config/config.yaml`. Если нужен другой файл, пока что меняйте константу или запускайте GUI.

## Типовой рабочий процесс

1. **Подготовить лабиринт**: создать YAML вручную или через панель генерации/CLI.
2. **Выбрать алгоритм** в панели, настроить скорость.
3. **Запустить симуляцию** (`Старт`/`Шаг`). Таймер можно ставить на паузу, сбрасывать или менять задержку динамически.
4. **Удалить/сгенерировать** новые лабиринты не выходя из приложения — список обновляется кнопкой «Обновить».

## Как расширять

- **Новый алгоритм**:
  1. Создать класс со `step()` и `get_state()`; для корректной покраски `path` должен быть множеством координат.
  2. Добавить в `Manager._create_solver` и `ControlsPanel.combo_algorithm`.
- **Импорт лабиринтов**: слот `MainWindow.on_import_requested` сейчас заглушка; здесь можно открыть файловый диалог, затем вызвать `write_maze_to_config`.
- **Настройки цветов и размеров**: пока захардкожены в `MazeView`. Можно вынести в YAML и подгружать в `MainWindow`.
- **Maze модель**: `src/core/maze.py` место для логики проверки валидности, типов клеток, кеша соседей и т.п.

## Известные пробелы

- Нет валидации YAML (например, конфликтующие старт/финиш). Добавить в `Manager`/`Maze`.
- Генератор не гарантирует достижимость цели.
- Нет автоматических тестов.
- Не реализован импорт внешних файлов через GUI.

Держите документ в актуальном состоянии: короткие заметки о найденных проблемах или новых соглашениях экономят время всей команде.
